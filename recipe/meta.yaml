{% set version = "1.2.6" %}

package:
    name: pyhams
    version: {{ version }}

source:
    url: https://github.com/WISDEM/pyHAMS/archive/v{{ version }}.tar.gz
    sha256: 28d1b347a4f2ae287a87fdcec5ea69ff05d53e6cb1cfe32efdc4ca74dd21b6c7
    # Download the tar-ball and do: openssl sha256 file.tar.gz to update
    patches:
        - meson_files.patch

build:
    number: 4
    skip: true  # [py<39]
    #script:
    #  - echo "python = '${PREFIX}/bin/python'" >> ${BUILD_PREFIX}/meson_cross_file.txt  # [build_platform != target_platform]
    #  - {{ PYTHON }} -m pip install . --no-deps -vv

requirements:
    build:
        - python                                 # [build_platform != target_platform]
        - cross-python_{{ target_platform }}     # [build_platform != target_platform]
        - meson                                  # [build_platform != target_platform]
        - meson-python                           # [build_platform != target_platform]
        - ninja                                  # [build_platform != target_platform]
        - nomkl                                  # [build_platform != target_platform]
        - numpy                                  # [build_platform != target_platform]
        - pkg-config                             # [build_platform != target_platform]
        - {{ stdlib('c') }}
        - {{ compiler('c') }}
        - {{ compiler('fortran') }}
    host:
        - compiler-rt                            # [win]
        - meson
        - meson-python
        - llvm-openmp                            # [osx or win]
        - libgomp                                # [linux]        
        # OpenBLAS on windows uses flang5 for some reason, so need mkl instead, but mkl brings intel-openmp which clashes with llvm-openmp
        # See https://github.com/conda-forge/scipy-feedstock/issues/257
        # See https://github.com/conda-forge/impactx-feedstock/blob/main/recipe/meta.yaml
        - openblas                               # [not win]
        #- blis                                   # [win]
        - ninja
        - nomkl                                  # [win]
        - numpy
        - pip
        - pkg-config
        - python
        - python-build
    run:
        - {{ pin_compatible('numpy') }}
        - python
        - llvm-openmp                            # [win]
        - nomkl                                  # [win]

test:
    imports:
        - pyhams
        - pyhams.pyhams
    requires:
        - pytest
    source_files:
        - test
    commands:
        - "cd test; pytest .; cd ..;"


about:
    home: https://github.com/WISDEM/pyHAMS
    license: Apache-2.0
    license_file: LICENSE
    summary: Python module wrapping around HAMS
    dev_url: https://github.com/WISDEM/pyHAMS
    
extra:
    recipe-maintainers:
        - mattEhall
        - dzalkind
        - gbarter
        - lucas-carmo
